% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bocpd.R
\name{bocpd}
\alias{bocpd}
\title{Bayesian Online Changepoint Detection (BOCPD)}
\usage{
bocpd(data, model, hazard, control = list())
}
\arguments{
\item{data}{A vector or list of observations in time order. If a vector is
supplied it will be treated as a sequence of scalar observations.}

\item{model}{A model object with methods \code{model_init()} and
\code{model_update()}, and internal components \code{pred_loglik} and
\code{prior}. See Details.}

\item{hazard}{A function \code{hazard(run_length, t, ...)} returning the hazard
probabilities for run lengths \code{run_length}. For a constant hazard use
\code{hazard_constant()}.}

\item{control}{Optional list of controls:
\itemize{
\item \code{r_max} integer; maximum run length retained (default: Inf).
\item \code{prune_eps} numeric; drop tail mass below this threshold after
normalization (default: 0).
\item \code{return_rl_matrix} logical; if TRUE, returns a dense matrix of
run-length posteriors (default: FALSE).
}}
}
\value{
If \code{return_rl_matrix = FALSE}, a list with:
\itemize{
\item \code{rl} list of numeric vectors; \code{rl[[t]]} is \eqn{P(r_t | x_{1:t})}.
\item \code{state} final model state (useful for streaming).
}
If \code{return_rl_matrix = TRUE}, also includes \code{rl_matrix}, a dense matrix
with rows indexed by time and columns by run length (truncated to \code{r_max}).
}
\description{
Implements the Bayesian online changepoint detection recursion
(run-length message passing) described by Adams and MacKay (2007).
The algorithm maintains a posterior distribution over the current run length
and updates it online using a hazard function and a predictive model.
}
\details{
The recursion uses only two transitions per time step: growth (\eqn{r \to r+1})
and changepoint (\eqn{r \to 0}). The predictive log-likelihood is evaluated
for each run-length hypothesis before posterior sufficient statistics are updated.

Model requirements:
\itemize{
\item \code{model_init(model)} returns a state list with fields \code{nu} (numeric)
and \code{chi} (list), each aligned with the current run-length support.
\item \code{model_update(model, state, x_t)} returns the \emph{next} state, with
run-length-shifted sufficient statistics (including prepending the prior).
\item \code{model$pred_loglik(nu, chi, x_t)} returns log predictive density for one hypothesis.
\item \code{model$prior} contains \code{nu} and \code{chi} to prepend on reset.
}
}
\examples{
set.seed(1)
x <- rnorm(50)
model <- gaussian_iid_model(mu0 = 0, sigma = 1)
h <- hazard_constant(1/100)
fit <- bocpd(x, model, h, control = list(r_max = 200, prune_eps = 1e-12))
length(fit$rl)


}
